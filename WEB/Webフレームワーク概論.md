## Webアプリケーションフレームワークを自作する
- パーフェクトPHP
・アプリケーションの土台となるライブラリ。フレームワークが用意されていれば、アプリケーションを作成する時に無駄な処理を記述せず本当に必要な処理に注力することが出来る。

## 作成するフレームワークの構成
- **ディレクトリ構造**
  - ドキュメントルート： Webサーバ（HTTPサーバ）やFTPサーバが外部に公開するファイルなどが置かれたディレクトリ（フォルダ）。そのディレクトリにあるファイルと、下の階層にあるファイルやディレクトリが公開される。

```
application/ ルートディレクトリ
  controllers/　コントローラーを配置
  core/　フレームワークを構成するクラスを配置
  models/　モデルを配置
  views/　ビュー（HTMLファイル）を配置
  web　ドキュメントルート
```  

- **MVCモデル**
  - ソフトウェアのアーキテクチャ。アプリケーションを「Model/View/Controller」という3つの役割に分けて実装を行う。
  - **Model**: アプリケーションのビジネスロジックを担う。Webアプリケーションでは、DBへアクセスしてデータの取得や変更を行う機能を記述する
  - **View**: 出力を担う。Webアプリケーションでは主にHTMLを出力するので、ビューではHTMLの組み立てや情報の出力を行う。
  - **Controller**: ユーザのリクエストを制御し、モデルから情報を取得してビューに橋渡しする。
  
- **フレームワークの構造**
  - Request: ユーザのリクエストを表す。ユーザがリクエストした際のGETやPOSTパラメータ、URL等の情報を管理する
  - Router：ユーザーがアクセスしてきたURLをRequestクラスで受け取り、どのControllerを呼び出すかを決定する。URLの制御。
  - Response：リクエストに対するレスポンス。最終的にユーザへ返すレスポンス情報を管理する。
  - DbManager：データベースへの接続情報やDbRepository（データベースアクセス制御）を管理するクラス。
  - DbRepository：実際にDBにアクセスを伴う処理を管理するクラス。テーブルごとにDbRepositoryクラスの子クラスを作成する。
  - Controller：ModelやViewの制御を行う。Controllerクラスの中に**アクション：メソッド**を定義する。アクション = 1画面。
  - View：表示を制御するクラス。ViewクラスにHTMLを書くわけではなく、HTMLが記述されたファイルの読み込みや変数の受け渡しを行う。
  - Session：セッションを管理するクラス。
  - Application：アプリケーション全体を表すクラス。RequestクラスやSessionクラスの初期化、Controllerの実行等、アプリケーション全体の流れを管理する。アプリケーションごとにこのクラスを継承したクラスを定義し、アプリケーション固有の設定（DB接続情報、URLとコントローラーの対応等）の定義を行う。
  - ClassLoader：クラスを定義したファイルを自動的に読み込むためのオートロードという仕組みを管理するクラス。
  <br/>
   <img src= "https://github.com/kuro-channel/TIL/blob/master/WEB/%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0%E3%83%AF%E3%83%BC%E3%82%AF%E3%81%AE%E5%87%A6%E7%90%86%E3%81%AE%E6%B5%81%E3%82%8C.jpg" width="400px" height="300px" alt="配列" title="配列">

### ルーティングとは？
- クライアントからのリクエストURLとそのURLに対応する処理を紐づけること（URLと処理のマッピング）
  - 処理は「Controller」で行う

```text
https://a.example.com/about
↑上記のようなリクエストがきた場合に、'AboutController'というコントローラーをマッピングして、リクエストをControllerに流す
```
  
- PHPで自作フレームワークを作ってみた
  - .htaccessの設定：原則としてすべてのアクセスをindex.phpにリライトさせる。
  - index.phpでリクエストURLを解析し、各Controllerに割り振る。
  - 「どんなアクセスでも、ひとまず受け止める」 > **フロントコントローラー**と呼ぶ。
  - やること! 1. 「.htaccessの設定」（WEBのルートディレクトリを配置） : .htaccessですべてのアクセスを「index.php」にリダイレクトする。

